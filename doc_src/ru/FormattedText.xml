<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "../../../docbook-xml-4.5/docbookx.dtd">
<chapter id="chapter.formatted.text">
  <title>Работа с форматированным текстом<indexterm class="singular">
      <primary>Переведённые файлы</primary> <secondary>Форматированный текст</secondary>
    </indexterm><indexterm class="singular">
      <primary>Исходные файлы</primary> <secondary>Форматированный текст</secondary>
    </indexterm></title>

  <para>Обычно в переведённом файле требуется сохранить форматирование оригинала. Информация о форматировании в поддерживаемых файлах (на момент написания это DocBook, HTML, XHTML, Open Document Format (ODF) и Office Open XML (MS Office 2007 и более новые версии)) представлена в ОмегаТ тегами. Как правило, при оценке степени схожести текстов, теги игнорируются. Теги, которые воспроизведены в переведённом сегменте, будут перенесены в переведённый документ.</para>

  <section id="formatting.tags">
    <title>Теги форматирования<indexterm class="singular">
        <primary>Теги</primary>
      </indexterm></title>

    <para><indexterm class="singular">
        <primary>Теги</primary> <secondary>Названия</secondary>
      </indexterm><emphasis role="bold">Названия тегов:</emphasis></para>

    <para>Названия тегов состоят из одной, двух или трёх букв и цифры. Уникальный номер позволяет, с одной стороны, группировать схожие теги, а с другой, различать те из них, которые названы одинаковыми буквами, но на самом деле представляют собой разные сущности. Буквы, используемые при наименовании тега, по возможности отражают форматирование, которое представляет данный тег (например, «b» обозначает «bold», полужирный шрифт, а «i» обозначает «italic», курсив).</para>

    <para><indexterm class="singular">
        <primary>Теги</primary> <secondary>Нумерация</secondary>
      </indexterm><emphasis role="bold">Нумерация тегов</emphasis></para>

    <para>Теги нумеруются в порядке возрастания, по группам. Под «группой тегов» в данном контексте понимаются один или два связанных по смыслу тега (например, &lt;i0&gt; и &lt;/i0&gt;). Внутри сегмента первая группа (пара или одиночный тег) получает номер 0, вторая — номер 1 и так далее. В первом примере ниже есть три группы тегов (пара, одиночный тег, затем снова пара тегов), во втором примере только одна группа (пара).</para>

    <para><indexterm class="singular">
        <primary>Теги</primary> <secondary>Парные и одиночные теги</secondary>
      </indexterm><emphasis role="bold">Парные и одиночные теги:</emphasis></para>

    <para>Теги могут быть либо одиночными, либо парными. Одиночные теги используются для представления форматирования, которое не затрагивает окружающий текст (например, дополнительный пробел или разрыв строки).</para>

    <para><literal>&lt;b0&gt;&lt;CTRL+N&gt;&lt;/b0&gt;, &lt;br1&gt;&lt;b2&gt;&lt;ВВОД&gt;&lt;/b2&gt;&lt;сегмент 2132&gt;</literal></para>

    <para>&lt;br1&gt;  — это одиночный тег, он не имеет отношения к окружающему его тексту. Парные теги обычно представляют форматирование текста, расположенного между открывающим и закрывающим тегом пары. &lt;b0&gt; и &lt;/b0&gt; ниже являются парными и относятся к тексту «log.txt». Обратите внимание, открывающий тег всегда должен находиться перед закрывающим:</para>

    <para>&lt;<literal>Файл журнала (&lt;b0&gt;log.txt&lt;/b0&gt;) для отслеживания действий пользователя и ошибок.&lt;сегмент 3167&gt;</literal></para>

    <para>В <application>ОмегаТ</application> теги внедряются в текст до того, как проводится сегментация. В зависимости от правил сегментации иногда может возникать ситуация, когда парный тег разбивается и попадает в два соседних сегмента. В окне проверки тегов такие сегменты будут помечаться как содержащие ошибки.</para>
  </section>

  <section id="tag.operations">
    <title>Операции с тегами<indexterm class="singular">
        <primary>Теги</primary> <secondary>Операции</secondary>
      </indexterm></title>

    <para>С тегами нужно обращаться осторожно. Если их случайно изменить, форматирование конечного файла может быть нарушено. Самым надёжным решением будет всегда сохранять в переводе исходные теги в исходном порядке. Однако, при соблюдении некоторых условий, от этого правила можно иногда отступать.</para>

    <para><emphasis role="bold"><indexterm class="singular">
        <primary>Теги</primary> <secondary>Повторение</secondary>
      </indexterm>Повторение тегов</emphasis></para>

    <para>Чтобы повторить группу тегов, просто скопируйте их в желаемое место в тексте. Помните, что открывающий тег всегда должен находиться перед закрывающим. Форматирование, представленное группой, которую вы продублировали, будет применено к тому месту, куда было произведено копирование.</para>

    <para>Пример:</para>

    <para><literal>&lt;b0&gt;Это форматирование&lt;/b0&gt; будет применено здесь&lt;сегмент 0001&gt;</literal></para>

    <para>После копирования:</para>

    <para><literal>&lt;b0&gt;Это форматирование&lt;/b0&gt; было применено &lt;b0&gt;здесь&lt;/b0&gt;.&lt;сегмент 0001&gt;</literal></para>

    <para><emphasis role="bold"><indexterm class="singular">
        <primary>Теги</primary> <secondary>Удаление групп</secondary>
      </indexterm>Удаление групп тегов</emphasis></para>

    <para>Чтобы убрать группу тегов, просто удалите её из сегмента. Помните, что нужно удалить как открывающие, так и закрывающие теги и убедиться, что все следы форматирования действительно стёрты. В противном случае созданный файл будет повреждён. Удаляя группу тегов, вы удаляете соответствующее форматирование из переведённого файла.</para>

    <para>Пример:</para>

    <para><literal>&lt;b0&gt;Это форматирование&lt;/b0&gt; будет удалено.&lt;сегмент 0001&gt;</literal></para>

    <para>После удаления:</para>

    <para><literal>Это форматирование было удалено.&lt;сегмент 0001&gt;</literal></para>
  </section>

  <section id="tag.group.nesting">
    <title>Вложенные группы тегов<indexterm class="singular">
        <primary>Теги</primary> <secondary>Вложенные группы</secondary>
      </indexterm></title>

    <para>Изменение групп тегов может привести к тому, что одна группа будет вложена в другую. Это нормально, пока внешняя группа полностью окружает вложенную. Другими словами, при перемещении парных тегов, всегда следите за тем, что и открывающий, и закрывающий теги оба находятся внутри (или оба находятся снаружи) другой группы тегов. В ином случае переведённый файл может быть повреждён и перестанет открываться.</para>

    <para>Пример:</para>

    <para><literal>&lt;b0&gt;Форматирование&lt;/b0&gt; &lt;b1&gt;один&lt;/b1&gt; будет скопировано внутрь форматирования ноль.&lt;сегмент 0001&gt;</literal></para>

    <para>После перемещения тегов:</para>

    <para><literal>&lt;b0&gt;Форматирование &lt;b1&gt;один&lt;/b1&gt;&lt;/b0&gt; было скопировано внутрь форматирования ноль.&lt;сегмент 0001&gt;</literal></para>
  </section>

  <section id="tag.group.overlapping">
    <title>Перекрывающиеся группы тегов<indexterm class="singular">
        <primary>Теги</primary> <secondary>Перекрывающиеся группы</secondary>
      </indexterm></title>

    <para>Перекрывание является результатом некорректного обращения с парами тегов и всегда приводит к порче форматирования, а иногда и к тому, что переведённый файл перестаёт открываться вообще.</para>

    <para>Пример:</para>

    <para><literal>&lt;b0&gt;Форматирование&lt;/b0&gt; &lt;b1&gt;один&lt;/b1&gt; будет испорчено.&lt;сегмент 0001&gt;</literal></para>

    <para>В результате некорректного обращения с тегами:</para>

    <para><literal>&lt;b0&gt;Форматирование &lt;b1&gt;один&lt;/b0&gt; &lt;/b1&gt;теперь сильно испорчено.&lt;segment 0001&gt;</literal></para>
  </section>

  <section>
    <title>Параметры проверки тегов</title>

    <para>Проверку тегов можно настроить в специальном диалоговом окне <guimenuitem>«Параметры &gt; Проверка тегов...»</guimenuitem>:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="images/OptionsTagValidation_25.png"/>
      </imageobject>
    </mediaobject>

    <para>Описанные ниже настройки применяются не только к файлам с форматированным текстом, но ко всем исходным файлам вообще.</para>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Переменные printf - не проверять, проверять простые, проверять все</emphasis></para>

        <para>ОмегаТ может проверять, чтобы программные переменные из исходного сегмента (такие как %s, например) присутствовали и в переводе. Вы можете решить отказаться от подобной проверки, выбрать проверку только простых переменных printf (таких как %s %d и т. д.) или проверку всех переменных printf.</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Проверять простые шаблоны Java MessageFormat</emphasis></para>

        <para>Если флажок установлен, ОмегаТ будет проверять корректность работы с простыми тегами Java MessageFormat (такими как {0}).</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Регулярные выражения для нестандартных тегов</emphasis></para>

        <para>Если ввести в это поле некое регулярное выражение, ОмегаТ будет рассматривать соответствующие этому шаблону подстроки как пользовательские теги. Как и в случае с обычными тегами ОмегаТ, для пользовательских тегов будет производиться проверка, присутствуют ли они в переводе в должном порядке и количестве.</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Регулярное выражение для удаления фрагментов из перевода</emphasis></para>

        <para>В это поле можно ввести регулярное выражение для поиска фрагментов текста, которые следует удалить из перевода. Любые совпадения в переведённых сегментах будут отмечены красным и их можно будет легко найти и исправить. При поиске нечётких совпадений это регулярное выражение игнорируется. Если удаляемая часть не совпадает с каким-либо другим сегментом, процент совпадения уменьшается на 5, так, чтобы совпадение не показывалось как точное.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section id="tag.group.validation">
    <title>Проверка групп тегов<indexterm class="singular">
        <primary>Теги</primary> <secondary>Проверка групп</secondary>
      </indexterm></title>

    <para>Функция проверки тегов определяет сегменты, в которых теги оригинала и перевода не совпадают и показывает их. При нажатии сочетания клавиш <guimenuitem>CTRL+T<indexterm class="singular">
        <primary>Сочетания клавиш</primary> <secondary>Проверка тегов - CTRL+T</secondary>
      </indexterm></guimenuitem> откроется окно с сегментами, при переводе которых теги возможно были расставлены неправильно. С помощью этого окна можно легко исправить теги и создать переведённые документы с правильным форматированием. Открывающееся при нажатии <guimenuitem>CTRL+T</guimenuitem> окно содержит таблицу из трёх столбцов, в которой для каждого сегмента с ошибками в тегах содержатся ссылка на него, а также текст оригинала и перевода.</para>

    <figure id="tag.validation">
      <title>Пример записи из окна проверки тегов</title>

      <mediaobject>
        <imageobject role="html">
          <imagedata fileref="images/TagValidation.png"/>
        </imageobject>

        <imageobject role="fo">
          <imagedata fileref="images/TagValidation.png" width="90%"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Теги выделены жирным шрифтом и синим цветом, чтобы можно было легко сравнить содержимое оригинала и перевода. Щелкните по ссылке, чтобы перейти к соответствующему сегменту в области редактирования. При необходимости исправьте ошибку (в примере выше надо добавить парный тег &lt;i2&gt;&lt;/i2&gt;) и нажмите <guimenuitem>CTRL+T</guimenuitem>, чтобы вернуться к окну проверки тегов для исправления других ошибок. Ошибками тегов считаются любые случаи, когда в переводе сегмента не воспроизводится точный порядок и число тегов оригинала. Некоторые изменения тегов необходимы и с ними приходится мириться, другие вызовут проблемы после создания переведённого документа.</para>
  </section>

  <section id="hints.for.tag.management">
    <title>Советы по управлению тегами<indexterm class="singular">
        <primary>Теги</primary> <secondary>Советы</secondary>
      </indexterm></title>

    <para><emphasis role="bold">Упростите исходный текст</emphasis></para>

    <para>Обычно теги несут какую-то информацию о форматировании исходного текста. Упрощение форматирования исходного текста сильно уменьшает количество тегов. Если это возможно, постарайтесь унифицировать используемые шрифты, размеры, цвета и т. п., так как это упрощает перевод и уменьшает количество возможных ошибок, связанных с тегами. Прочитайте раздел «Операции с тегами», чтобы получить представление о том, что с ними можно делать. Имейте в виду, что если теги вас раздражают, а форматирование не очень важно для текущего перевода, то удаление тегов может стать решением проблемы.</para>

    <para><emphasis role="bold">Уделяйте особое внимание парным тегам</emphasis></para>

    <para>Если вы хотите видеть теги в ОмегаТ, но вам не нужно сохранять большую часть форматирования в переведённом документе, вы можете просто не добавлять теги в перевод. В этом случае обратите особое внимание на пары тегов, поскольку если вы удалите одну из частей пары, но забудете удалить другую, то гарантированно испортите форматирование переведённого документа. Поскольку теги являются частью текста, уменьшить их количество можно за счёт соответствующих настроек правил сегментации. Для правильной работы с этой функцией необходим некоторый опыт.</para>

    <para>В настоящее время ОмегаТ не умеет полностью автоматически определять ошибки в форматировании, поэтому не отличает ошибок от изменений, сделанных в рамках адаптации оформления под язык перевода. Однако иногда в переведённом файле может быть нарушено форматирование, а в некоторых случаях он может вообще перестать открываться.</para>
  </section>
</chapter>